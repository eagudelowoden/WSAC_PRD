<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Registro de Documentos</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="/css/registro.css">


</head>
<body>

<div class="container">
    <div class="container-box">

        <h2 class="text-center mb-4">üìÑ Registro de Documentos</h2>

        <form id="formularioRegistro" action="/api/enviar" method="POST" enctype="multipart/form-data">

            <h3 class="section-title">Datos Personales</h3>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Nombres Completos *</label>
                    <input type="text" class="form-control" name="nombres" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Apellidos Completos *</label>
                    <input type="text" class="form-control" name="apellidos" required>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="form-label">Documento de Identidad *</label>
                    <input type="text" class="form-control" name="documento" required>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="form-label">N√∫mero de tel√©fono *</label>
                    <input type="text" class="form-control" name="telefono" required>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="form-label">Correo Electr√≥nico *</label>
                    <input type="email" class="form-control" name="correo" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Direcci√≥n de Residencia *</label>
                    <input type="text" class="form-control" name="direccion" required>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">Fecha de Nacimiento *</label>
                    <input type="date" class="form-control" name="fechaNacimiento" required>
                </div>


                <div class="col-md-3 mb-3">
                    <label class="form-label">EPS *</label>
                    <input type="text" class="form-control" name="epsNombre" required>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">ARL *</label>
                    <input type="text" class="form-control" name="arlNombre" required>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">AFP *</label>
                    <input type="text" class="form-control" name="afpNombre" required>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">CCF *</label>
                    <input type="text" class="form-control" name="ccfNombre" required>
                </div>

            </div>

            <h3 class="section-title">Carga de Documentos</h3>

            <div class="mb-3">
                <label class="form-label">Fotocopia de la c√©dula ampliada al 150% *</label>
                <input type="file" class="form-control" name="cedula" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Certificados de estudio, acta de grado o diploma (hasta 5)</label>
                <input type="file" class="form-control" name="estudios" multiple>
            </div>

            <div class="mb-3">
                <label class="form-label">Certificados laborales (si tiene)</label>
                <input type="file" class="form-control" name="laborales">
            </div>

            <div class="mb-3">
                <label class="form-label">Certificado de fondo de cesant√≠as y pensi√≥n</label>
                <input type="file" class="form-control" name="cesantias">
            </div>

            <div class="mb-3">
                <label class="form-label">Certificado de cuenta bancaria *</label>
                <input type="file" class="form-control" name="cuenta" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Certificado de EPS (hasta 5) *</label>
                <input type="file" class="form-control" name="epsDocs" multiple required>
            </div>

            <div class="mb-3">
                <label class="form-label">2 Referencias Personales (hasta 5)</label>
                <input type="file" class="form-control" name="referencias" multiple>
            </div>

            <div class="mb-3">
                <label class="form-label">Agente de campo (SOAT, Tecnomec√°nica, tarjeta de propiedad, licencia) ‚Äî Hasta 5</label>
                <input type="file" class="form-control" name="agenteCampo" multiple>
            </div>

            <div class="mb-3">
                <label class="form-label">Hoja de vida actualizada *</label>
                <input type="file" class="form-control" name="hv" required>
            </div>

            <div class="mb-3">
                <label class="form-label">HABEAS DATA *</label>
                <input type="file" class="form-control" name="habeas" required>
            </div>

            <div class="mb-3">
                <label class="form-label">CONSENTIMIENTO INFORMADO *</label>
                <input type="file" class="form-control" name="consentimiento" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Afiliaciones de Familiares *</label>
                <input type="text" class="form-control" name="afiliacionesFamiliares" placeholder="Ej: S√≠, 2 personas / No" required>
            </div>

            <button type="submit" class="btn btn-primary mt-3 w-100 btn-lg">Enviar formulario</button>

        </form>
    </div>
</div>

<script>
    document.getElementById('formularioRegistro').addEventListener('submit', async function(e) {
        e.preventDefault(); 
        const formData = new FormData(this);
        const PORT = '';
        const URL_BASE = ''; // Deja esto vac√≠o para usar localhost

        try {
            Swal.fire({
                title: 'Enviando...',
                text: 'Procesando datos...',
                allowOutsideClick: false,
                didOpen: () => Swal.showLoading()
            });

            const response = await fetch(`${URL_BASE}/api/enviar`, {
                method: 'POST',
                body: formData
            });

            // 1. Leemos la respuesta como TEXTO primero para ver qu√© llega realmente
            const textResponse = await response.text();
            console.log("Respuesta del servidor:", textResponse); // <--- MIRA ESTO EN LA CONSOLA (F12)

            // 2. Intentamos convertir ese texto a JSON
            let data;
            try {
                data = JSON.parse(textResponse);
            } catch (jsonError) {
                // Si falla aqu√≠, es que el servidor envi√≥ HTML (probablemente un error)
                throw new Error("El servidor no devolvi√≥ JSON. Mira la consola para ver el error HTML.");
            }

            // 3. Verificamos el status l√≥gico
            if (response.ok && data.status === 'ok') {
                Swal.fire({
                    icon: 'success',
                    title: '¬°√âxito!',
                    text: data.message,
                    confirmButtonText: 'Aceptar'
                }).then(() => {
                    document.getElementById('formularioRegistro').reset();
                });
            } else {
                throw new Error(data.message || 'Error desconocido en el servidor');
            }

        } catch (error) {
            console.error('ERROR GRAVE:', error);
            Swal.fire({
                icon: 'error',
                title: 'Ocurri√≥ un error',
                // Esto mostrar√° el error t√©cnico si lo hay
                text: error.message 
            });
        }
    });
</script>

</body>
</html>